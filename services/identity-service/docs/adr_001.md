ADR-001: Escolha do Amazon DynamoDB para o Identity Service

1. Contexto
  O identity-service é um microserviço fundamental no ecossistema do fintrack. As suas responsabilidades são críticas e centralizadas na gestão do ciclo de vida da identidade do usuário, incluindo registo, autenticação (login), gestão de tokens e verificação de perfil.

  Como porta de entrada para a aplicação, este serviço possui requisitos não-funcionais rigorosos:

  Alta Disponibilidade: O serviço deve estar sempre online; uma falha impede o acesso a toda a plataforma.

  Baixa Latência: As operações de login e validação de identidade devem ser concluídas em milissegundos para garantir uma boa experiência do usuário.

  Escalabilidade Massiva: A arquitetura deve suportar de forma transparente o crescimento de alguns milhares para dezenas de milhões de usuários sem degradação da performance.

A escolha da base de dados para este serviço é, portanto, uma das decisões de arquitetura mais críticas do projeto.

----------------- // -----------------

2. Decisão
  O identity-service utilizará o Amazon DynamoDB como a sua principal e exclusiva base de dados.

----------------- // -----------------

3. Justificativa
  A decisão de adotar o DynamoDB, um banco de dados NoSQL, em detrimento de uma solução relacional (como o PostgreSQL), baseia-se num princípio fundamental de design de sistemas distribuídos: utilizar a ferramenta certa para o trabalho certo. A análise dos padrões de acesso do serviço de identidade revela um alinhamento perfeito com as forças do DynamoDB.


3.1. Alinhamento com os Padrões de Acesso 
  No DynamoDB, o design da tabela é ditado pelas perguntas que a aplicação precisa de responder. Os padrões de acesso do identity-service são bem definidos, limitados e focados em chaves:
    Busca por ID de Usuário: "Dados os dados de um usuário, sabendo o seu UserID." (Ex: após validar um token JWT).

    Busca por Email: "Verificar se um email já existe" ou "Buscar um usuário para validar uma senha no login."

    Escrita de usuário: "Salvar um novo usuário" ou "Atualizar o perfil de um usuário existente."

  Estes são padrões de acesso de chave-valor clássicos. Não há necessidade de JOINs complexos ou agregações. O DynamoDB foi projetado do zero para otimizar este tipo de acesso, oferecendo uma performance ordens de magnitude superior à de um banco de dados relacional para estas operações específicas.


3.2. Escalabilidade e Performance Previsível
  O DynamoDB oferece escalabilidade horizontal praticamente ilimitada. A sua arquitetura particionada garante que a performance de leitura e escrita (GetItem, PutItem, Query) permanece constante (latência de milissegundos de um dígito), independentemente do volume de dados. Para um serviço de identidade crítico que pode tornar-se um gargalo, esta previsibilidade de performance é uma vantagem arquitetural decisiva.


3.3. Modelo de Dados Flexível (Preparado para o Futuro)
  O domínio de identidade está em constante evolução. No futuro, poderemos precisar de adicionar atributos complexos aos nossos usuários, como configurações de MFA, dados de verificação biométrica ou perfis de redes sociais. Com o modelo de esquema flexível do DynamoDB, a adição destes novos atributos não requer migrações de esquema dispendiosas (ALTER TABLE) ou paragens de serviço, garantindo agilidade na evolução do produto.

----------------- // -----------------

4. Consequências e Trade-offs
  A escolha do DynamoDB é uma decisão de design consciente com trade-offs claros.

  Vantagens (O que Ganhamos):

  Performance extrema para os nossos padrões de acesso conhecidos.

  Escalabilidade massiva com gestão simplificada.

  Flexibilidade de esquema para a evolução futura do modelo de utilizador.

  Alinhamento com as práticas da indústria para serviços de identidade de grande escala.

  Desvantagens (O que Abdicamos):

  Flexibilidade de Consulta: Perdemos a capacidade de executar queries complexas. Qualquer novo padrão de acesso que não tenha sido planejado pode exigir a criação de um novo GSI ou uma migração de dados.

  Ausência de JOINs: A análise de dados que requer a combinação de diferentes entidades torna-se mais complexa e geralmente é delegada a sistemas de data warehousing.

Para o identity-service, onde os padrões de acesso são bem definidos e a performance/escalabilidade são os requisitos mais importantes, as vantagens do DynamoDB superam em muito as suas desvantagens.